# Doom Stuff

Little repository for my setup for playing Doom. It contains some utility scripts and also serves as a place I can document things I want to remember.

## Scripts

There are scripts here that will setup a Windows machine for playing Doom and will generate 'launchers' for starting each level in a game with a pistol.

### Prerequisites

For running these scripts:

* Install the [Windows Subsystem for Linux](https://docs.microsoft.com/en-us/windows/wsl/install-win10)
* Install [Powershell Core](https://github.com/PowerShell/PowerShell/releases)
* Install the AWS tools for Powershell: `Install-Module -Name AWSPowerShell.NetCore`
* Use the module: `Import-Module -Name AWSPowerShell.NetCore`
* Setup AWS credentials for S3: `Set-AWSCredential -AccessKey <key> -SecretKey <key> -StoreAs s3`
* In WSL use your shell to set a `WINDOWS_DOOM_HOME` environment variable to a Windows style path of where you want the Doom home directory to be, e.g. `C:\\Users\\Chris\\doom`.
* In WSL use your shell to set a `UNIX_DOOM_HOME` environment variable to a Windows style path of where you want the Doom home directory to be, e.g. `/c/Users/Chris/doom`.

### Run Scripts

After this is done, you can run `doom\bootstrap.ps1`. This script will:

* Create a `doom` directory in `%USERPROFILE%` with self explanatory sub-directories
* Install various source ports
* Download source port configuration files from this repo
* Download `DOOM.WAD` and `DOOM2.WAD` iwad files
* Download various pwad files
* Download various modifications

Once that's been done, there's a little Python script that can generate the launchers. Launchers are just a set of batch files for each game, one for each mission (note: a 'game' here really refers to a WAD, e.g. SIGIL.WAD, not Doom or Doom 2 (though both of those happen to be a game too)). These batch files allow you to quickly start any level in the game with a pistol.

To run the script you need to use WSL, which should have an Ubuntu environment that comes with a Python installation. Run the `generate-launchers.py` script and follow the prompts.

## Recording Demos for YouTube

### Setup

There are some steps required for software to install and configure:

* Install [OBS Studio](https://obsproject.com/)
* Install [HitFilm Express](https://fxhome.com/hitfilm-express)
* Configure OBS to record videos at 1080p:
    - Click on Settings -> Video
    - Set `Base (Canvas) Resolution` to `3840x2160`
    - Set `Output (Scaled) Resolution` to `1920x1080`
    - Set `Downscale Filter` to `Bicubic`
    - Set `Common FPS Values` to `60`
* Configure OBS to record mp4 by going to Settings -> Video and setting `Recording Format` to `mp4`
* Add a recording source:
    - Run GZDoom in window mode and leave it running
    - Click on the `+` button in the `Sources` section in the GUI and select `Game Capture`
    - Set `Mode` to `Capture specific window`
    - Set `Window` to entry beginning `[gzdoom.exe]`
    - Set `Window Match Priority` to `Match title, otherwise find window of same executable`
    - Make sure `Limit capture framerate` and `Capture Cursor` are unticked

### Recording the Demo

You can't immediately launch into the demo using a batch file because there's an issue with OBS recording a blank screen for the first 10 seconds or so. I searched on Google for many hours trying to find a resolution to this, but nothing worked.

With this in mind, here are the instructions for recording the demo 'manually':

* Copy the demo file to the source port directory and rename it to remove the timestamp from the file (the timestamp is generated by a script that records the demo)
* Set the volume on the audio source to 100%
* Launch OBS
* Click on the `Start Recording` button in OBS
* Use the `start.bat` file which will launch the game without the `-playdemo` option or warping to a particular map
* Leave the game running for 10 or 15 seconds to allow OBS to 'catch up' (this is where the blank screen occurs in the resulting video)
* Use the console to start the demo with `playdemo <name>.lmp`
* Wait until the demo completes
* Exit GZDoom and click on `Stop Recording` in OBS

### Edit the Demo Video

Use HitFilm to trim the beginning and end from the video. As a one time step, you need to edit the YouTube exporting preset to use 60FPS. See [this](https://www.youtube.com/watch?v=ybKZVT5Fm18) video for a guide.

Just create a new project, import the video OBS created and then [trim](https://fxhome.com/reference-manuals/hitfilm-express) it by using `Set In and Out Points`. Once the in and out points have been set, click and drag the video from the asset list on the left side to the video track. After that, just export the video to get a new MP4.

### Upload to YouTube

Finally, the video can be uploaded to YouTube. This is a really straight forward process that can be done through their GUI. There is a `youtube-video-description.txt` file in this repository that can be used to provide a description that can be copied and pasted.
